#!/usr/bin/env bash
set -euo pipefail

_about_input_box() {
	cat <<EOF
Display input box with title and message, returns user input.

Usage:
	input_box "text" [default_value]
	echo "text" | input_box
	result=\$(input_box "Enter name:" "default")

	help - this message
EOF
}

input_box() {
	local message="${1:-$(cat)}"
	local default_value="${2:-}"

	if [ "$message" = "help" ] || [ "$message" = "-h" ]; then
		_about_input_box
		return 0
	fi
	if [ -z "$message" ]; then
		echo "Error: Missing message" >&2
		return 2
	fi

	local result
	TITLE="${TITLE:-Input}"

	case "$DIALOG" in
		whiptail)
			result=$(whiptail --title "$TITLE" --inputbox "$message" 10 60 "$default_value" 3>&1 1>&2 2>&3) || return $?
			echo "$result"
			;;
		dialog)
			result=$(dialog --title "$TITLE" --inputbox "$message" 10 60 "$default_value" 3>&1 1>&2 2>&3) || return $?
			echo "$result"
			;;
		read)
			echo "$TITLE"
			echo
			echo "$message"
			if [ -n "$default_value" ]; then
				read -p "[$default_value]: " -r result < /dev/tty
				result="${result:-$default_value}"
			else
				read -p ": " -r result < /dev/tty
			fi
			echo "$result"
			;;
		"")
			echo "Error: DIALOG variable not set" >&2
			return 3
			;;
		*)
			echo "Error: Unknown dialog backend: $DIALOG" >&2
			return 4
			;;
	esac
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
	DIALOG="whiptail"
	TITLE="$DIALOG Test"
	result=$(input_box "Enter your name (whiptail):" "Default Name")
	echo "You entered: '$result'"

	DIALOG="dialog"
	TITLE="$DIALOG Test"
	result=$(input_box <<< "Enter your email (dialog):")
	echo "You entered: '$result'"

	DIALOG="read"
	TITLE="$DIALOG Test"
	result=$(input_box "Enter a number (read):" "42")
	echo "You entered: '$result'"
fi
</newLines>

<rationale>
Replace the existing staging/input_box.sh with a lightweight shim that maintains the original shebang and strict flags, sources the new implementation, and exports the functions for backward compatibility.
</rationale>
<newLines>
#!/bin/bash
set -euo pipefail

# input_box module has been moved to src/framework/input_box.sh
# This file provides backward compatibility

# Source the actual implementation
source "$(dirname "$0")/../src/framework/input_box.sh"

# Export the functions for use
export -f input_box
export -f _about_input_box